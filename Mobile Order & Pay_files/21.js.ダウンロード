(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{849:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(14),o=r(10),i=r(5),s=r(16),u=r(2),d=r(4),l=r(94),b=r(12),g=function(){return(g=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};t.default=Object(c.connect)((function(e){var t;return{authState:e.auth,mainCard:e.mainCard,loginUrl:(null===(t=e.auth.data)||void 0===t?void 0:t.loginUrl)||""}}),(function(e){return{getToken:function(t,r){return void 0===r&&(r={}),e(Object(b.l)(t,r))},getMainCard:function(){return e(Object(s.o)())},getLoginUrl:function(t){return e(Object(b.o)(t,!1))}}}))((function(e){var t=e.authState,r=e.getToken,c=e.mainCard,s=e.getMainCard,b=e.loginUrl,O=e.getLoginUrl,f=new URLSearchParams(Object(o.useLocation)().search),j=Object(o.useHistory)(),p=JSON.parse(Object(d.r)(u.o.ORDER_COMPLETED)),h=(null==p?void 0:p.selectedUsage)===i.a.DRIVE_IN&&!(null==p?void 0:p.isCheckInCompleted),E=function(e){j.push(e)};return Object(n.useEffect)((function(){if(Object(d.f)()){var e=Object(d.r)(u.o.LOGIN_TIME),t=Number.isInteger(+e)&&(new Date).getTime()-+e>12096e5;Object(d.I)(u.o.ACTIVE_TIPS,t)}Object(d.I)(u.o.LOGIN_TIME,(new Date).getTime())}),[]),Object(n.useEffect)((function(){var e=f.get("code"),t=f.get("session_state"),n=f.get("pageRedirect"),a=f.get("noCardRedirect"),c=Object(d.u)(u.r,f),o=f.get("serial_number");n.includes("ticket_kind_id")&&o&&(n=n+"&serial_number="+o),Object(d.y)(c)||(n=""+n+Object(d.w)(c)),window.history.replaceState(null,null,n||"/");var i=g(g({},n?{pageRedirect:n}:{}),a?{noCardRedirect:a}:{});e&&t?r(e,i):n?O({pageRedirect:n}):E("/")}),[]),Object(n.useEffect)((function(){b&&(location.href=b)}),[b]),Object(n.useEffect)((function(){if(!b&&t&&(t.data||t.hasError)){var e=f.get("pageRedirect");f.get("noCardRedirect")?s():function(e){var t=Object(d.u)(u.r,f),r=f.get("serial_number");switch(!0){case"/order/choose-store"===e&&h:p.justLoggedIn=!0,Object(d.I)(u.o.ORDER_COMPLETED,p),E("/order/choose-store");break;case"/order/choose-products/mfl"===e:E("/order/choose-products/mfl");break;case e.includes("ticket_kind_id")&&r&&r.length>0:E(e+"&serial_number="+r);break;default:var n=e.includes("storeCode"),a=Object(d.r)(u.o.USAGE),c=e.includes("itemCode"),o=JSON.parse(Object(d.r)(u.o.MFL_FLAG));Object(d.H)(u.o.MFL_FLAG),E(e+(c&&o?"&"+u.q+"="+o:"")+(Object(d.y)(t)?"":Object(d.w)(t))+(n&&a?"&usage="+a:"")||"/")}}(e)}}),[t]),Object(n.useEffect)((function(){if(!b&&t&&t.data&&(!Object(d.y)(c.data)||c.hasError)){var e=f.get("pageRedirect"),r=f.get("noCardRedirect");Object(d.y)(c.data)?E(r||"/"):E(e||"/")}}),[c]),a.a.createElement("div",{className:"page page-loading"},a.a.createElement("span",{className:"loading-indicator txt-silver"},a.a.createElement(l.a,null)))}))}}]);